<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Lua Editor ‚Äî –†–∞–±–æ—Ç–∞ —Å code.lua</title>
  <style>
    body { font-family: sans-serif; max-width: 800px; margin: 30px auto; padding: 20px; }
    textarea { width: 100%; height: 280px; font-family: monospace; font-size: 14px; }
    .btn { padding: 8px 16px; margin: 4px; }
    .status { margin-top: 8px; font-size: 13px; color: #555; }
    .saved { background: #f0f0f0; cursor: not-allowed; }
  </style>
</head>
<body>
  <h2>üìù –†–µ–¥–∞–∫—Ç–æ—Ä code.lua</h2>
  <p>1. –ü–æ–ª–æ–∂–∏—Ç–µ <code>code.lua</code> –≤ —ç—Ç—É –ø–∞–ø–∫—É.<br>
     2. –ù–∞–∂–º–∏—Ç–µ ¬´üìÇ –ó–∞–≥—Ä—É–∑–∏—Ç—å code.lua¬ª, –≤—ã–±–µ—Ä–∏—Ç–µ –µ–≥–æ ‚Üí –∫–æ–¥ –ø–æ—è–≤–∏—Ç—Å—è –≤ –ø–æ–ª–µ.<br>
     3. –†–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ ‚Üí ¬´üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å¬ª ‚Üí —Å–∫–∞—á–∞–µ—Ç—Å—è –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π <code>code.lua</code> (–∑–∞–º–µ–Ω–∏—Ç–µ —Å—Ç–∞—Ä—ã–π).</p>

  <textarea id="code" placeholder="–ó–∞–≥—Ä—É–∑–∏—Ç–µ code.lua –∏–ª–∏ –≤–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –≤—Ä—É—á–Ω—É—é..."></textarea><br><br>

  <button class="btn" onclick="loadFile()">üìÇ –ó–∞–≥—Ä—É–∑–∏—Ç—å code.lua</button>
  <button class="btn" id="saveBtn" onclick="saveFile()" disabled>üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å (code.lua)</button>
  <button class="btn" id="editBtn" onclick="enableEdit()" disabled>‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>

  <div class="status" id="status">–°—Ç–∞—Ç—É—Å: –æ–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏...</div>

  <!-- –°–∫—Ä—ã—Ç—ã–π input –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞ -->
  <input type="file" id="fileInput" accept=".lua,.txt" style="display:none">

  <script>
    const codeArea = document.getElementById('code');
    const saveBtn = document.getElementById('saveBtn');
    const editBtn = document.getElementById('editBtn');
    const statusEl = document.getElementById('status');
    const fileInput = document.getElementById('fileInput');

    let isSaved = false;

    // –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ —á–µ—Ä–µ–∑ –≤—ã–±–æ—Ä
    function loadFile() {
      fileInput.click();
    }

    fileInput.onchange = () => {
      const file = fileInput.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = (e) => {
        codeArea.value = e.target.result;
        isSaved = true;
        updateUI();
        statusEl.textContent = `‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω: ${file.name} (${Math.round(file.size)} –±–∞–π—Ç)`;
      };
      reader.onerror = () => {
        statusEl.textContent = "‚ùå –û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞";
      };
      reader.readAsText(file, 'utf-8');
    };

    function enableEdit() {
      isSaved = false;
      updateUI();
      codeArea.focus();
    }

    function saveFile() {
      const code = codeArea.value;
      if (!code.trim()) {
        alert('‚ö†Ô∏è –ö–æ–¥ –ø—É—Å—Ç–æ–π!');
        return;
      }

      const blob = new Blob([code], { type: 'text/plain;charset=utf-8' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'code.lua'; // ‚Üê –≤—Å–µ–≥–¥–∞ code.lua
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);

      isSaved = true;
      updateUI();
      statusEl.textContent = '‚úÖ code.lua —Å–æ—Ö—Ä–∞–Ω—ë–Ω (–∑–∞–º–µ–Ω–∏—Ç–µ –∏–º —Å—Ç–∞—Ä—ã–π —Ñ–∞–π–ª –≤ –ø–∞–ø–∫–µ)';
    }

    function updateUI() {
      if (isSaved) {
        codeArea.classList.add('saved');
        codeArea.setAttribute('readonly', 'true');
        saveBtn.disabled = true;
        editBtn.disabled = false;
      } else {
        codeArea.classList.remove('saved');
        codeArea.removeAttribute('readonly');
        saveBtn.disabled = false;
        editBtn.disabled = true;
      }
    }

    // –ò–∑–Ω–∞—á–∞–ª—å–Ω–æ –∫–Ω–æ–ø–∫–∞ "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å" –∞–∫—Ç–∏–≤–Ω–∞, –µ—Å–ª–∏ –≤–≤–µ–¥—ë–Ω –∫–æ–¥ –≤—Ä—É—á–Ω—É—é
    codeArea.addEventListener('input', () => {
      if (!isSaved && codeArea.value.trim()) {
        saveBtn.disabled = false;
      }
    });
  </script>
</body>
</html>
