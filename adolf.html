<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–†–µ–¥–∞–∫—Ç–æ—Ä code.lua (–ø—Ä—è–º–∞—è –∑–∞–ø–∏—Å—å)</title>
  <style>
    body { font-family: sans-serif; max-width: 800px; margin: 20px auto; padding: 20px; }
    textarea { width: 100%; height: 300px; font-family: monospace; font-size: 14px; }
    .btn { padding: 8px 16px; margin: 4px; }
    .status { margin-top: 8px; font-size: 13px; color: #555; }
  </style>
</head>
<body>
  <h2>‚öôÔ∏è –†–µ–¥–∞–∫—Ç–æ—Ä code.lua ‚Äî –ø—Ä—è–º–∞—è –∑–∞–ø–∏—Å—å</h2>
  <p>1. –ù–∞–∂–º–∏—Ç–µ ¬´üìÇ –û—Ç–∫—Ä—ã—Ç—å code.lua¬ª ‚Üí –≤—ã–±–µ—Ä–∏—Ç–µ <code>code.lua</code> –≤ –ø–∞–ø–∫–µ.<br>
     2. –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ –∫–æ–¥.<br>
     3. –ù–∞–∂–º–∏—Ç–µ ¬´üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å¬ª ‚Üí —Ñ–∞–π–ª <b>–ø–µ—Ä–µ–∑–∞–ø–∏—à–µ—Ç—Å—è –Ω–∞ –º–µ—Å—Ç–µ</b>.<br>
     <small>‚ö†Ô∏è –†–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –≤ Chrome / Edge (—á–µ—Ä–µ–∑ http://localhost)</small></p>

  <textarea id="code" placeholder="–°–Ω–∞—á–∞–ª–∞ –æ—Ç–∫—Ä–æ–π—Ç–µ code.lua..."></textarea><br><br>

  <button class="btn" onclick="openFile()">üìÇ –û—Ç–∫—Ä—ã—Ç—å code.lua</button>
  <button class="btn" id="saveBtn" onclick="saveFile()" disabled>üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>

  <div class="status" id="status">–°—Ç–∞—Ç—É—Å: –æ–∂–∏–¥–∞–Ω–∏–µ –æ—Ç–∫—Ä—ã—Ç–∏—è —Ñ–∞–π–ª–∞...</div>

  <script>
    const codeArea = document.getElementById('code');
    const saveBtn = document.getElementById('saveBtn');
    const statusEl = document.getElementById('status');

    let fileHandle = null;

    // –û—Ç–∫—Ä—ã—Ç–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ code.lua (–∏–ª–∏ –ª—é–±–æ–≥–æ .lua/.txt)
    async function openFile() {
      try {
        const [handle] = await window.showOpenFilePicker({
          types: [{ description: 'Lua —Ñ–∞–π–ª—ã', accept: { 'text/lua': ['.lua'], 'text/plain': ['.txt'] } }],
          multiple: false
        });
        fileHandle = handle;
        const file = await fileHandle.getFile();
        const content = await file.text();
        codeArea.value = content;
        saveBtn.disabled = false;
        statusEl.textContent = `‚úÖ –û—Ç–∫—Ä—ã—Ç: ${file.name}`;
      } catch (err) {
        if (err.name !== 'AbortError') {
          statusEl.textContent = '‚ùå –û—à–∏–±–∫–∞: ' + (err.message || err);
        }
      }
    }

    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ —Ç–æ—Ç –∂–µ fileHandle (–ø–µ—Ä–µ–∑–∞–ø–∏—Å—å!)
    async function saveFile() {
      const code = codeArea.value;
      if (!code.trim()) {
        alert('‚ö†Ô∏è –ö–æ–¥ –ø—É—Å—Ç–æ–π!');
        return;
      }

      if (!fileHandle) {
        alert('‚ö†Ô∏è –°–Ω–∞—á–∞–ª–∞ –æ—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª —á–µ—Ä–µ–∑ ¬´–û—Ç–∫—Ä—ã—Ç—å code.lua¬ª!');
        return;
      }

      try {
        const writable = await fileHandle.createWritable();
        await writable.write(code);
        await writable.close();
        statusEl.textContent = '‚úÖ –£—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤ code.lua (–Ω–∞ –º–µ—Å—Ç–µ!)';
      } catch (err) {
        statusEl.textContent = '‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø–∏—Å–∏: ' + (err.message || err);
      }
    }

    // Enable save if typing before opening (optional)
    codeArea.addEventListener('input', () => {
      if (codeArea.value.trim()) {
        if (!fileHandle && saveBtn.disabled) {
          saveBtn.title = '–°–Ω–∞—á–∞–ª–∞ –æ—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª';
        }
      }
    });
  </script>
</body>
</html>
