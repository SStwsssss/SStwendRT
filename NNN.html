<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>SSTWENDRT</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      background: #121212;
      color: #e0e0e0;
      font-family: 'Courier New', monospace;
      font-size: 14px;
      line-height: 1.4;
      padding: 20px;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: flex-start;
    }

    .container {
      width: 100%;
      max-width: 720px;
      background: #1e1e1e;
      border: 1px solid #444444;
      padding: 20px;
    }

    h1 {
      font-weight: normal;
      font-size: 18px;
      margin-bottom: 16px;
      border-bottom: 1px solid #444444;
      padding-bottom: 6px;
      letter-spacing: 1px;
    }

    .tabs {
      display: flex;
      margin-bottom: 12px;
      border-bottom: 1px solid #444;
    }
    .tab {
      padding: 8px 16px;
      cursor: pointer;
      user-select: none;
      background: #2a2a2a;
      border: 1px solid #444;
      border-bottom: none;
      margin-right: 4px;
    }
    .tab.active { background: #1e1e1e; border-color: #555; }

    .tab-content { display: none; }
    .tab-content.active { display: block; }

    .controls {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-bottom: 12px;
      justify-content: center;
    }

    .controls button {
      padding: 8px 14px;
      background: #2d2d2d;
      color: #e0e0e0;
      border: 1px solid #444444;
      font-family: inherit;
      font-size: 13px;
      cursor: pointer;
      outline: none;
      transition: background 0.15s;
    }

    .controls button:hover {
      background: #3a3a3a;
    }

    .controls button:active {
      background: #444444;
    }

    .status {
      min-height: 1.2em;
      margin: 6px 0;
      font-size: 13px;
      display: none;
    }

    .status.ok { color: #b0c4b0; }
    .status.error { color: #c4b0b0; }
    .status.loading { color: #b0b0b0; }

    textarea {
      width: 100%;
      height: 300px;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      resize: vertical;
      border: 1px solid #444444;
      padding: 10px;
      background: #1a1a1a;
      color: #e6e6e6;
      white-space: pre;
      tab-size: 2;
    }

    textarea::placeholder {
      color: #666666;
    }

    textarea:focus {
      outline: 2px solid #555555;
      outline-offset: -2px;
    }

    @media (max-width: 500px) {
      .controls { flex-direction: column; }
      .controls button { width: 100%; }
      .tabs { flex-wrap: wrap; }
      .tab { flex: 1; text-align: center; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>SSTWENDRT DATABASE</h1>

    <div class="tabs">
      <div class="tab active" onclick="switchTab('code')">CODE</div>
      <div class="tab" onclick="switchTab('nicks')">NICKS</div>
    </div>

    <div id="code-tab" class="tab-content active">
      <div class="controls">
        <button onclick="save('code')">SEND</button>
        <button onclick="load('code')">LOAD</button>
        <button onclick="copy('code')">COPY</button>
        <button onclick="clearAll('code')">CLEAR</button>
      </div>
      <div id="code-status" class="status"></div>
      <textarea id="code" spellcheck="false" placeholder="// Lua script here..."></textarea>
    </div>

    <div id="nicks-tab" class="tab-content">
      <div class="controls">
        <button onclick="save('nicks')">SEND</button>
        <button onclick="load('nicks')">LOAD</button>
        <button onclick="copy('nicks')">COPY</button>
        <button onclick="clearAll('nicks')">CLEAR</button>
      </div>
      <div id="nicks-status" class="status"></div>
      <textarea id="nicks" spellcheck="false" placeholder="User1, User2, Moderator, Admin"></textarea>
    </div>
  </div>

  <script>
    // ✅ ЕДИНСТВЕННОЕ ИЗМЕНЕНИЕ: новая база, без пробелов
    const baseUrl = "https://checker-bd715-default-rtdb.firebaseio.com/";
    const endpoints = {
      code: baseUrl + "code.json",
      nicks: baseUrl + "nicks.json"
    };

    function setStatus(id, text, type = "ok") {
      const el = document.getElementById(`${id}-status`);
      el.textContent = text;
      el.className = "status " + type;
      el.style.display = text ? "block" : "none";
      if (type === "ok" && text) setTimeout(() => setStatus(id, ""), 1500);
    }

    function switchTab(tab) {
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
      document.querySelector(`.tab:nth-child(${tab === 'code' ? 1 : 2})`).classList.add('active');
      document.getElementById(`${tab}-tab`).classList.add('active');
    }

    function load(tab) {
      const url = endpoints[tab];
      const textarea = document.getElementById(tab);
      setStatus(tab, "LOADING", "loading");
      textarea.disabled = true;

      fetch(url)
        .then(r => {
          if (!r.ok) throw new Error(`HTTP ${r.status}`);
          return r.text(); // ← используем .text(), а не .json(), чтобы ловить HTML-логин
        })
        .then(text => {
          if (text.trim() === "null") {
            throw new Error("Data is null");
          }
          if (text.includes("登录") || text.includes("<!DOCTYPE")) {
            throw new Error("Login page — database not public");
          }

          try {
            const data = JSON.parse(text);
            let val = "";
            if (typeof data === "string") {
              val = data;
            } else if (Array.isArray(data)) {
              val = data.join(", ");
            } else if (typeof data === "object" && data !== null) {
              val = JSON.stringify(data, null, 2);
            }
            textarea.value = val;
            setStatus(tab, "OK", "ok");
          } catch (e) {
            throw new Error("Invalid JSON: " + e.message);
          }
        })
        .catch(err => {
          textarea.value = "";
          setStatus(tab, `ERR: ${err.message}`, "error");
        })
        .finally(() => {
          textarea.disabled = false;
          textarea.focus();
        });
    }

    function save(tab) {
      const textarea = document.getElementById(tab);
      const content = textarea.value.trim();
      if (!content) {
        setStatus(tab, "EMPTY", "error");
        return;
      }

      let payload;
      if (tab === "nicks") {
        // Сохраняем как строку (как в Pastebin)
        payload = JSON.stringify(content);
        // Если хочешь массив — раскомментируй:
        // payload = JSON.stringify(content.split(",").map(s => s.trim()).filter(Boolean));
      } else {
        payload = JSON.stringify(content);
      }

      setStatus(tab, "SAVING", "loading");
      textarea.disabled = true;

      fetch(endpoints[tab], {
        method: "PUT",
        body: payload,
        headers: { "Content-Type": "application/json" }
      })
        .then(r => {
          if (!r.ok) throw new Error(`HTTP ${r.status}`);
          return r;
        })
        .then(() => setStatus(tab, "OK", "ok"))
        .catch(err => setStatus(tab, `ERR: ${err.message}`, "error"))
        .finally(() => {
          textarea.disabled = false;
          textarea.focus();
        });
    }

    function copy(tab) {
      const text = document.getElementById(tab).value;
      if (!text) {
        setStatus(tab, "EMPTY", "error");
        return;
      }
      if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(text)
          .then(() => setStatus(tab, "COPIED", "ok"))
          .catch(() => fallbackCopy(text));
      } else {
        fallbackCopy(text);
      }
    }

    function fallbackCopy(text) {
      const textarea = document.createElement("textarea");
      textarea.value = text;
      document.body.appendChild(textarea);
      textarea.select();
      document.execCommand("copy");
      document.body.removeChild(textarea);
      setStatus("code", "COPIED (fallback)", "ok");
    }

    function clearAll(tab) {
      const textarea = document.getElementById(tab);
      if (textarea.value && !confirm(`Clear ${tab.toUpperCase()}?`)) return;
      textarea.value = "";
      setStatus(tab, "CLEARED", "ok");
    }

    document.addEventListener("keydown", e => {
      const activeTab = document.querySelector('.tab-content.active')?.id?.replace('-tab', '');
      if (!activeTab) return;
      if ((e.ctrlKey || e.metaKey) && e.key === "s") { e.preventDefault(); save(activeTab); }
      if ((e.ctrlKey || e.metaKey) && e.key === "r") { e.preventDefault(); load(activeTab); }
    });

    // Init
    load('code');
    load('nicks');
  </script>
</body>
</html>
