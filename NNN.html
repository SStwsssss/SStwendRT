<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>SStwendRT Checker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      background: #121212;
      color: #e0e0e0;
      font-family: 'Courier New', monospace;
      font-size: 14px;
      line-height: 1.4;
      padding: 20px;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: flex-start;
    }
    .container {
      width: 100%;
      max-width: 720px;
      background: #1e1e1e;
      border: 1px solid #444;
      padding: 20px;
    }
    h1 {
      font-weight: normal;
      font-size: 18px;
      margin-bottom: 16px;
      border-bottom: 1px solid #444;
      padding-bottom: 6px;
    }
    .section {
      margin-bottom: 24px;
    }
    .section-header {
      display: flex;
      gap: 8px;
      align-items: center;
      margin-bottom: 10px;
    }
    .tab {
      padding: 4px 10px;
      background: #2d2d2d;
      border: 1px solid #444;
      font-size: 16px;
      opacity: 0.6;
      cursor: pointer;
      user-select: none;
      transition: opacity 0.2s, background 0.2s;
    }
    .tab.active {
      opacity: 1;
      background: #3a3a3a;
      border-color: #666;
    }
    .controls {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-bottom: 12px;
      justify-content: center;
    }
    .controls button {
      padding: 8px 14px;
      background: #2d2d2d;
      color: #e0e0e0;
      border: 1px solid #444;
      font: inherit;
      font-size: 13px;
      cursor: pointer;
      outline: none;
      transition: background 0.15s;
    }
    .controls button:hover { background: #3a3a3a; }
    .controls button:active { background: #444; }
    .status {
      min-height: 1.2em;
      margin: 6px 0;
      font-size: 13px;
      display: none;
    }
    .status.ok { color: #b0c4b0; }
    .status.error { color: #c4b0b0; }
    .status.loading { color: #b0b0b0; }

    .content-area {
      position: relative;
      width: 100%;
    }
    textarea, input {
      width: 100%;
      font: 13px 'Courier New', monospace;
      resize: vertical;
      border: 1px solid #444;
      padding: 10px;
      background: #1a1a1a;
      color: #e6e6e6;
      white-space: pre;
      tab-size: 2;
    }
    textarea {
      height: 400px;
    }
    input {
      height: 36px;
      margin-top: 6px;
    }
    textarea:focus, input:focus {
      outline: 2px solid #555;
      outline-offset: -2px;
    }
    .hidden {
      display: none !important;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="section">
      <div class="section-header">
        <div class="tab active" data-tab="code">Code</div>
        <div class="tab" data-tab="nicks">Players</div>
        <div class="tab" data-tab="checker">Checker</div>
        <div class="tab" data-tab="custom-script">Custom Script</div>
        <div class="tab" data-tab="custom-players">Custom Players</div>
        <span style="flex: 1;"></span>
      </div>

      <div class="controls">
        <button onclick="sendCurrent()">SEND</button>
        <button onclick="loadCurrent()">LOAD</button>
        <button onclick="copyCurrent()">COPY</button>
        <button onclick="clearCurrent()">CLEAR</button>
      </div>

      <div id="status" class="status"></div>

      <div class="content-area">
        <textarea id="code" spellcheck="false" placeholder="// Paste Lua code here..."></textarea>
        <textarea id="nicks" class="hidden" spellcheck="false" placeholder="plr1,plr2,plr3 â€” one per line or comma-separated"></textarea>
        <div id="checker" class="hidden">
          <textarea id="checker-code" spellcheck="false" placeholder="// Checker Lua code here..."></textarea>
          <input type="text" id="checker-name" placeholder="Enter checker name (optional)">
        </div>
        <textarea id="custom-script" class="hidden" spellcheck="false" placeholder="// Custom Lua script here..."></textarea>
        <textarea id="custom-players" class="hidden" spellcheck="false" placeholder="player&#10;,&#10;player&#10;,&#10;Player"></textarea>
      </div>
    </div>
  </div>

  <script>
  const CODE_URL = "https://access-code-8936a-default-rtdb.firebaseio.com/.json";
  const NICKS_URL = "https://accesnames-default-rtdb.firebaseio.com/nicks.json";
  const CHECKER_URL = "https://checker-d6b5d-default-rtdb.firebaseio.com/";
  const CUSTOM_SCRIPT_URL = "https://dsasadasdsada-default-rtdb.firebaseio.com/.json";
  const CUSTOM_PLAYERS_URL = "https://dfsfdfsdfsdf-a79bf-default-rtdb.firebaseio.com/.json";

  const LOCAL_CODE_KEY = "sstwendrt_code";
  const LOCAL_NICKS_KEY = "sstwendrt_nicks";
  const LOCAL_CHECKER_CODE_KEY = "sstwendrt_checker_code";
  const LOCAL_CHECKER_NAME_KEY = "sstwendrt_checker_name";
  const LOCAL_CUSTOM_SCRIPT_KEY = "sstwendrt_custom_script";
  const LOCAL_CUSTOM_PLAYERS_KEY = "sstwendrt_custom_players";

  const elements = {
    code: document.getElementById("code"),
    nicks: document.getElementById("nicks"),
    "checker-code": document.getElementById("checker-code"),
    "checker-name": document.getElementById("checker-name"),
    "custom-script": document.getElementById("custom-script"),
    "custom-players": document.getElementById("custom-players"),
  };

  const statusEl = document.getElementById("status");
  let currentTab = "code";

  // Restore from localStorage
  Object.entries({
    code: LOCAL_CODE_KEY,
    nicks: LOCAL_NICKS_KEY,
    "custom-script": LOCAL_CUSTOM_SCRIPT_KEY,
    "custom-players": LOCAL_CUSTOM_PLAYERS_KEY,
    "checker-code": LOCAL_CHECKER_CODE_KEY,
    "checker-name": LOCAL_CHECKER_NAME_KEY,
  }).forEach(([id, key]) => {
    if (elements[id]) elements[id].value = localStorage.getItem(key) || "";
  });

  // Save on input
  Object.entries({
    code: LOCAL_CODE_KEY,
    nicks: LOCAL_NICKS_KEY,
    "custom-script": LOCAL_CUSTOM_SCRIPT_KEY,
    "custom-players": LOCAL_CUSTOM_PLAYERS_KEY,
    "checker-code": LOCAL_CHECKER_CODE_KEY,
  }).forEach(([id, key]) => {
    if (elements[id]) {
      elements[id].addEventListener("input", () => localStorage.setItem(key, elements[id].value));
    }
  });
  if (elements["checker-name"]) {
    elements["checker-name"].addEventListener("input", () => localStorage.setItem(LOCAL_CHECKER_NAME_KEY, elements["checker-name"].value));
  }

  document.querySelectorAll(".tab").forEach(tab => {
    tab.addEventListener("click", () => {
      const target = tab.dataset.tab;
      if (target === currentTab) return;

      document.querySelector(`.tab[data-tab="${currentTab}"]`).classList.remove("active");
      tab.classList.add("active");

      // Hide all
      ["code", "nicks", "checker", "custom-script", "custom-players"]
        .forEach(id => {
          if (id === "checker") document.getElementById("checker").classList.add("hidden");
          else if (elements[id]) elements[id].classList.add("hidden");
        });

      currentTab = target;
      if (target === "checker") document.getElementById("checker").classList.remove("hidden");
      else if (elements[target]) elements[target].classList.remove("hidden");
    });
  });

  function setStatus(text, type = "ok") {
    statusEl.textContent = text;
    statusEl.className = "status " + type;
    statusEl.style.display = text ? "block" : "none";
    if (type === "ok" && text) setTimeout(() => {
      if (statusEl.textContent === text) setStatus("");
    }, 1500);
  }

  function getCurrentData() {
    switch (currentTab) {
      case "code": return { value: elements.code.value.trim(), key: "code" };
      case "nicks": return { value: elements.nicks.value.trim(), key: "nicks" };
      case "checker": return {
        value: elements["checker-code"].value.trim(),
        name: elements["checker-name"].value.trim() || "main",
        key: "checker"
      };
      case "custom-script": return { value: elements["custom-script"].value.trim(), key: "custom-script" };
      case "custom-players": return { value: elements["custom-players"].value.trim(), key: "custom-players" };
      default: return null;
    }
  }

  function getCurrentUrlAndPayload() {
    const data = getCurrentData();
    if (!data?.value) return null;

    switch (data.key) {
      case "code": return { url: CODE_URL, payload: JSON.stringify(data.value) };
      case "nicks": return { url: NICKS_URL, payload: JSON.stringify(data.value) };
      case "checker": return {
        url: `${CHECKER_URL}checkers/${encodeURIComponent(data.name)}.json`,
        payload: JSON.stringify(data.value)
      };
      case "custom-script": return { url: CUSTOM_SCRIPT_URL, payload: JSON.stringify(data.value) };
      case "custom-players": return { url: CUSTOM_PLAYERS_URL, payload: JSON.stringify(data.value) };
      default: return null;
    }
  }

  function getActiveArea() {
    if (currentTab === "checker") return elements["checker-code"];
    return elements[currentTab];
  }

  function sendCurrent() {
    const info = getCurrentData();
    if (!info?.value) return setStatus("EMPTY", "error");

    const req = getCurrentUrlAndPayload();
    if (!req) return setStatus("ERR", "error");

    setStatus("SAVING", "loading");
    const area = getActiveArea();
    if (area) area.disabled = true;

    fetch(req.url, {
      method: "PUT",
      body: req.payload,
      headers: { "Content-Type": "application/json" }
    })
    .then(r => {
      if (!r.ok) throw new Error(`HTTP ${r.status}`);
      return r.text();
    })
    .then(() => setStatus("OK", "ok"))
    .catch(err => setStatus(`ERR: ${err.message || err}`, "error"))
    .finally(() => { if (area) area.disabled = false; area?.focus(); });
  }

  function loadCurrent() {
    setStatus("LOADING", "loading");

    let area, url;
    switch (currentTab) {
      case "code": area = elements.code; url = CODE_URL; break;
      case "nicks": area = elements.nicks; url = NICKS_URL; break;
      case "checker": {
        const name = elements["checker-name"].value.trim() || "main";
        area = elements["checker-code"];
        url = `${CHECKER_URL}checkers/${encodeURIComponent(name)}.json`;
        break;
      }
      case "custom-script": area = elements["custom-script"]; url = CUSTOM_SCRIPT_URL; break;
      case "custom-players": area = elements["custom-players"]; url = CUSTOM_PLAYERS_URL; break;
      default: return;
    }

    if (area) area.disabled = true;

    fetch(url)
      .then(r => {
        if (r.status === 404) return "null";
        if (!r.ok) throw new Error(`HTTP ${r.status}`);
        return r.text();
      })
      .then(text => {
        if (!text || text === "null") {
          setStatus(currentTab === "checker" ? "NOT FOUND" : "EMPTY", "ok");
          return;
        }
        let value = "";
        try {
          const data = JSON.parse(text);
          value = typeof data === "string" ? data : "";
        } catch (e) {
          value = text;
        }
        area.value = value;
        const keyMap = {
          "code": LOCAL_CODE_KEY,
          "nicks": LOCAL_NICKS_KEY,
          "checker-code": LOCAL_CHECKER_CODE_KEY,
          "custom-script": LOCAL_CUSTOM_SCRIPT_KEY,
          "custom-players": LOCAL_CUSTOM_PLAYERS_KEY,
        };
        const storageKey = keyMap[currentTab === "checker" ? "checker-code" : currentTab];
        if (storageKey) localStorage.setItem(storageKey, value);
        setStatus("OK", "ok");
      })
      .catch(err => setStatus(`ERR: ${err.message || err}`, "error"))
      .finally(() => { if (area) area.disabled = false; area?.focus(); });
  }

  function copyCurrent() {
    let text = "";
    if (currentTab === "checker") text = elements["checker-code"].value;
    else text = elements[currentTab]?.value || "";

    if (!text) return setStatus("EMPTY", "error");
    
    if (navigator.clipboard) {
      navigator.clipboard.writeText(text).then(() => setStatus("COPIED", "ok"));
    } else {
      const tmp = document.createElement("textarea");
      tmp.value = text;
      document.body.appendChild(tmp);
      tmp.select();
      document.execCommand("copy");
      document.body.removeChild(tmp);
      setStatus("COPIED", "ok");
    }
  }

  function clearCurrent() {
    if (!confirm(`Clear ${currentTab}?`)) return;

    const clearMap = {
      "code": () => { elements.code.value = ""; localStorage.removeItem(LOCAL_CODE_KEY); },
      "nicks": () => { elements.nicks.value = ""; localStorage.removeItem(LOCAL_NICKS_KEY); },
      "checker": () => {
        elements["checker-code"].value = "";
        elements["checker-name"].value = "";
        localStorage.removeItem(LOCAL_CHECKER_CODE_KEY);
        localStorage.removeItem(LOCAL_CHECKER_NAME_KEY);
      },
      "custom-script": () => { elements["custom-script"].value = ""; localStorage.removeItem(LOCAL_CUSTOM_SCRIPT_KEY); },
      "custom-players": () => { elements["custom-players"].value = ""; localStorage.removeItem(LOCAL_CUSTOM_PLAYERS_KEY); },
    };

    clearMap[currentTab]?.();
    setStatus("CLEARED", "ok");
  }

  document.addEventListener("keydown", e => {
    if ((e.ctrlKey || e.metaKey) && e.key === "s") { e.preventDefault(); sendCurrent(); }
    if ((e.ctrlKey || e.metaKey) && e.key === "r") { e.preventDefault(); loadCurrent(); }
  });

  loadCurrent();
  </script>
</body>
</html>
