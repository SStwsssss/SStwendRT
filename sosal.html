<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>P.D.A Chat</title>
  <style>
    body { font: 16px sans-serif; max-width: 600px; margin: 20px auto; }
    #chat { border: 1px solid #ccc; height: 300px; overflow-y: auto; padding: 10px; }
    input { padding: 8px; margin-right: 5px; }
    #msg { width: 60%; }
    #nick { width: 25%; }
  </style>
</head>
<body>
  <h2>P.D.A</h2>
  <div id="chat"></div>
  <br>
  <input id="nick" placeholder="Name" maxlength="15">
  <input id="msg" placeholder="Messange" disabled>
  <button id="send" disabled>âž¤</button>

  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

  <script>
    const db = firebase.initializeApp({
      databaseURL: "https://my-chat-site-2d226-default-rtdb.firebaseio.com/"
    }).database();

    const chat = document.getElementById('chat');
    const nickInp = document.getElementById('nick');
    const msgInp = document.getElementById('msg');
    const sendBtn = document.getElementById('send');

    let userNick = localStorage.getItem('userNick');

    if (userNick) {
      nickInp.value = userNick;
      nickInp.disabled = true;
      msgInp.disabled = false;
      sendBtn.disabled = false;
    }

    nickInp.onkeypress = e => {
      if (e.key === 'Enter' && !userNick) {
        const n = nickInp.value.trim();
        if (n) {
          userNick = n;
          localStorage.setItem('userNick', userNick);
          nickInp.disabled = true;
          msgInp.disabled = false;
          sendBtn.disabled = false;
          msgInp.focus();
        }
      }
    };

    function send() {
      const text = msgInp.value.trim();
      if (!userNick || !text) return;
      db.ref('messages').push({ nick: userNick, text });
      msgInp.value = '';
    }

    sendBtn.onclick = send;
    msgInp.onkeypress = e => { if (e.key === 'Enter') send(); };

    db.ref('messages').limitToLast(50).on('child_added', snap => {
      const { nick, text } = snap.val();
      const div = document.createElement('div');
      div.innerHTML = `<b>${nick}</b>: ${text}`;
      chat.appendChild(div);
      chat.scrollTop = chat.scrollHeight;
    });
  </script>
</body>
</html>
