<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Lua Obfuscator — loadstring() Safe (Roblox Legacy)</title>
  <style>
    body { font-family: monospace; padding: 20px; background: #0d0d0d; color: #ccc; }
    textarea { width: 100%; background: #1a1a1a; color: #eee; border: 1px solid #444; resize: vertical; font-family: monospace; }
    button { margin: 8px 0; padding: 6px 12px; background: #2a2a2a; color: #fff; border: 1px solid #555; cursor: pointer; }
    button:hover { background: #3a3a3a; }
    h3 { color: #aaa; margin-top: 16px; }
  </style>
</head>
<body>
  <h3>Lua Code:</h3>
  <textarea id="code" rows="6" placeholder="print('Hello!')">local x = 42; print('Result:', x * 2)</textarea><br>
  <button onclick="make()">Obfuscate → loadstring()</button>

  <h3>Output (paste into loadstring(...))</h3>
  <textarea id="out" rows="22" readonly></textarea><br>
  <button onclick="copy()">Copy</button>

  <script>
    function randVar() {
      const chars = "abcdefghijklmnopqrstuvwxyz";
      const len = 3 + Math.floor(Math.random() * 5);
      return Array.from({length: len}, () => chars[Math.floor(Math.random() * chars.length)]).join('');
    }

    function obfuscateData(str, key) {
      let hex = "";
      for (let i = 0; i < str.length; i++) {
        const c = str.charCodeAt(i);
        const k = key.charCodeAt(i % key.length);
        let x = c ^ k;
        if (x === 0) x = 1; // avoid \0
        hex += x.toString(16).padStart(2, '0');
      }
      return hex.match(/.{1,2}/g).reverse().join('');
    }

    function make() {
      const code = document.getElementById("code").value.trim();
      if (!code) return alert("Enter Lua code first!");

      const key = "k" + Math.random().toString(36).slice(2, 6); // e.g. "k9x2"

      const encrypted = obfuscateData(code, key);

      const v_s = randVar();
      const v_k = randVar();
      const v_d = randVar();
      const v_i = randVar();
      const v_b = randVar();
      const v_p = randVar();
      const v_c = randVar();
      const v_x = randVar();
      const v_ch = randVar();

      // ✅ Полностью совместимо с Roblox Legacy (Lua 5.1)
      const loader =
`(function()
  local function bxor(a,b)
    local r,p=0,1
    while a>0 or b>0 do
      if a%2~=b%2 then r=r+p end
      a,b=math.floor(a/2),math.floor(b/2)
      p=p*2
    end
    return r
  end
  local ${v_s},${v_k}="${encrypted}","${key}"
  local ${v_d}=""
  for ${v_i}=1,#${v_s},2 do
    local ${v_b}=tonumber(${v_s}:sub(${v_i},${v_i}+1),16)
    if ${v_b} then
      local ${v_p}=(#${v_s}/2-${v_i}/2+1)%#${v_k}+1
      local ${v_c}=${v_k}:byte(${v_p})
      local ${v_x}=bxor(${v_b},${v_c})
      local ${v_ch}=${v_x}%256
      if ${v_ch}==0 then ${v_ch}=1 end
      ${v_d}=${v_d}..string.char(${v_ch})
    end
  end
  local f=loadstring(${v_d})
  if not f then error("load failed") end
  return f()
end)()`;

      document.getElementById("out").value = loader;
    }

    function copy() {
      const ta = document.getElementById("out");
      ta.select();
      document.execCommand("copy");
      alert("✅ Copied — works in ANY Roblox Lua!");
    }
  </script>
</body>
</html>
