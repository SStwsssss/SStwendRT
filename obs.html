<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Lua Obfuscator for loadstring (Roblox Legacy Safe)</title>
  <style>
    body {
      font-family: monospace;
      padding: 20px;
      background: #0d0d0d;
      color: #ccc;
    }
    textarea {
      width: 100%;
      background: #1a1a1a;
      color: #eee;
      border: 1px solid #444;
      resize: vertical;
      font-family: monospace;
    }
    button {
      margin: 8px 0;
      padding: 6px 12px;
      background: #2a2a2a;
      color: #fff;
      border: 1px solid #555;
      cursor: pointer;
    }
    button:hover {
      background: #3a3a3a;
    }
    h3 {
      color: #aaa;
      margin-top: 16px;
    }
  </style>
</head>
<body>
  <h3>Lua Code:</h3>
  <textarea id="code" rows="6" placeholder="print('Hello!')">local x = 42; print('Result:', x * 2)</textarea><br>
  <button onclick="make()">Obfuscate → loadstring()</button>

  <h3>Output (paste into loadstring(...))</h3>
  <textarea id="out" rows="12" readonly></textarea><br>
  <button onclick="copy()">Copy</button>

  <script>
    function randVar() {
      const chars = "abcdefghijklmnopqrstuvwxyz";
      const len = 3 + Math.floor(Math.random() * 5);
      let s = "";
      for (let i = 0; i < len; i++) s += chars[Math.floor(Math.random() * chars.length)];
      return s;
    }

    function obfuscateData(str, key) {
      let hex = "";
      for (let i = 0; i < str.length; i++) {
        const c = str.charCodeAt(i);
        const k = key.charCodeAt(i % key.length);
        let x = c ^ k;
        if (x === 0) x = 1; // avoid \0
        hex += x.toString(16).padStart(2, '0');
      }
      return hex.match(/.{1,2}/g).reverse().join('');
    }

    function make() {
      const code = document.getElementById("code").value.trim();
      if (!code) return alert("Enter Lua code first!");

      // Безопасный ключ: только буквы, без спецсимволов
      const key = "k" + Math.random().toString(36).slice(2, 7); // например: "k9xm2a"

      const encrypted = obfuscateData(code, key);

      // Имена
      const v_s = randVar();
      const v_k = randVar();
      const v_i = randVar();
      const v_n = randVar();
      const v_b = randVar();
      const v_d = randVar();

      // ✅ Полностью совместимо с Roblox Legacy Lua (5.1)
      const loader =
`(function()
  local ${v_s},${v_k}="${encrypted}","${key}"
  local ${v_d}=""
  for ${v_i}=1,#${v_s},2 do
    local ${v_b}=tonumber(${v_s}:sub(${v_i},${v_i}+1),16)
    if ${v_b} then
      local p=(#${v_s}/2-${v_i}/2+1)%#${v_k}+1
      local c=${v_k}:byte(p)
      local x=${v_b}~c
      ${v_d}=${v_d}..string.char(x%256==0 and 1 or x%256)
    end
  end
  return loadstring(${v_d})()
end)()`;

      document.getElementById("out").value = loader;
    }

    function copy() {
      const ta = document.getElementById("out");
      ta.select();
      document.execCommand("copy");
      alert("✅ Ready for loadstring!");
    }
  </script>
</body>
</html>
